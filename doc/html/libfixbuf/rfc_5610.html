<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libfixbuf: RFC 5610</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">RFC 5610 </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_doc_rfc_5610"></a> </p>
<h1><a class="anchor" id="export-read"></a>
How-To Export and Read Enterprise Element Definitions</h1>
<h2><a class="anchor" id="what_5610"></a>
What is RFC 5610?</h2>
<p ><a href="https://tools.ietf.org/html/rfc5610">RFC 5610</a> provides a mechanism to export full type information for Information Elements from the IPFIX Information Model. Libfixbuf version 1.4 and later provides API functions to create IPFIX Option Template/Records that can encode the full set of properties for the definition of an Information Element in order for a Collecting Process to be able to know how to decode data that contains enterprise-specific Information Elements.</p>
<h2><a class="anchor" id="exp"></a>
RFC 5610 Exporters</h2>
<p >To create a new enterprise-specific Information Element, the Exporting Process should define a new information element using the <a class="el" href="public_8h.html#ac36983de4e17c281e44582a418d5477d" title="Convenience macro for creating full fbInfoElement_t static initializer.">FB_IE_INIT_FULL()</a> macro to provide the name, private enterprise number, id, length, description, data type, and units of the information element. The Information Elements should then be added to the Information Model using <a class="el" href="public_8h.html#a4244c83afec83db26a1924fda60f57de" title="Adds a single information element to an information model.">fbInfoModelAddElement()</a> or <a class="el" href="public_8h.html#ac2b0be79429a02c8026ce7ea8f9ab2e5" title="Adds multiple information elements in an array to an information model.">fbInfoModelAddElementArray()</a>. Alternatively, a file or a string containing an XML registry that describes Information Elements may be parsed and loaded into the Information Model using <a class="el" href="public_8h.html#af72db51fd417df411a82909c5fd5d84d" title="Adds information specified in the given XML file to the information model.">fbInfoModelReadXMLFile()</a> or <a class="el" href="public_8h.html#a2bbcf6d4a777ed7e0a2c364e0662b9f3" title="Adds information specified in the given XML data to the information model.">fbInfoModelReadXMLData()</a>.</p>
<p >Once an enterprise-specific information element exists, there are two ways to export that information. The simplest way is to configure automated enterprise-specific information element information export. This is done by calling <a class="el" href="public_8h.html#a2e729b270df473a1f32f519ed184a259" title="Configures a session to export type information for enterprise-specific information elements as optio...">fbSessionSetMetadataExportElements()</a> with the <code>enabled</code> parameter set to <code>TRUE</code>. Once this has been set, the full set of information elements in the information model that have a non-zero Private Enterprise Number will be exported every time template records are exported (<a class="el" href="public_8h.html#a4e0c42fc80985c048190203257697ab6" title="Exports all external templates in the current domain of a given session.">fbSessionExportTemplates()</a>).</p>
<p >The other option is to export the information element options records manually. An information element options template can then be created using <a class="el" href="public_8h.html#a8717daf369b4b88ac82e0d5c83759abc" title="Allocates and returns the Options Template that will be used to define Information Element Type Recor...">fbInfoElementAllocTypeTemplate()</a>. This creates an option template that contains all of the necessary properties to define an Information Element:</p>
<ul>
<li>privateEnterpriseNumber</li>
<li>informationElementId</li>
<li>informationElementDataType</li>
<li>informationElementSemantics</li>
<li>informationElementUnits</li>
<li>informationElementRangeBegin</li>
<li>informationElementRangeEnd</li>
<li>informationElementName</li>
<li>informationElementDescription</li>
</ul>
<p >Then the template can be added to the session using <a class="el" href="public_8h.html#a5a23a76ff4edff6616b5db2fbd63644f" title="Adds a Template to a Session.">fbSessionAddTemplate()</a>. You will need to add it twice, once as an internal template, and once as an external template. Create the exporter and fbuf as described above for the necessary mode of transport. Then, to write out an information element options record, use <a class="el" href="public_8h.html#a7609daac6e38cd53b6dae0002ad715f2" title="Exports an options record to the given fbuf with information element type information about the given...">fbInfoElementWriteOptionsRecord()</a>, using the template IDs returned by the <a class="el" href="public_8h.html#a5a23a76ff4edff6616b5db2fbd63644f" title="Adds a Template to a Session.">fbSessionAddTemplate()</a> calls as the internal and export template IDs, passing it a pointer to the information element you want to export. For example:</p>
<div class="fragment"><div class="line"><a class="code hl_function" href="public_8h.html#a7609daac6e38cd53b6dae0002ad715f2">fbInfoElementWriteOptionsRecord</a>(</div>
<div class="line">    fbuf, <a class="code hl_function" href="public_8h.html#a5896a5cee1c40f993056b698c945ae70">fbInfoModelGetElementByName</a>(infoModel, <span class="stringliteral">&quot;myNewElement&quot;</span>),</div>
<div class="line">    itid, etid, *err);</div>
<div class="ttc" id="apublic_8h_html_a5896a5cee1c40f993056b698c945ae70"><div class="ttname"><a href="public_8h.html#a5896a5cee1c40f993056b698c945ae70">fbInfoModelGetElementByName</a></div><div class="ttdeci">const fbInfoElement_t * fbInfoModelGetElementByName(const fbInfoModel_t *model, const char *name)</div><div class="ttdoc">Returns a pointer to the canonical information element within an information model given the informat...</div></div>
<div class="ttc" id="apublic_8h_html_a7609daac6e38cd53b6dae0002ad715f2"><div class="ttname"><a href="public_8h.html#a7609daac6e38cd53b6dae0002ad715f2">fbInfoElementWriteOptionsRecord</a></div><div class="ttdeci">gboolean fbInfoElementWriteOptionsRecord(fBuf_t *fbuf, const fbInfoElement_t *model_ie, uint16_t itid, uint16_t etid, GError **err)</div><div class="ttdoc">Exports an options record to the given fbuf with information element type information about the given...</div></div>
</div><!-- fragment --><p >The Options Record will automatically be appended to the fbuf and will be sent upon calling <a class="el" href="public_8h.html#a3def007c235fd0dccb7a2293b23341e1" title="Emits the message currently in a buffer using the associated exporting process endpoint.">fBufEmit()</a>.</p>
<h2><a class="anchor" id="col"></a>
RFC 5610 - Collector Usage</h2>
<p >In order to collect the above Options records, the collecting process may use <a class="el" href="public_8h.html#a620d1ac952f0c3f10d0a8b3fd3628171" title="Enables automatic insertion of RFC 5610 elements read from a Buffer.">fBufSetAutomaticElementInsert()</a> after creating an fBuf to automatically insert any information elements into the Information Model. For security reasons, libfixbuf does not add elements whose informationElementName already exists in the model, whose (privateEnterpriseNumber, informationElementId) pair already exists in the model, or whose privateEnterpriseNumber is 0 or FB_IE_PEN_REVERSE. libfixbuf also rejects elements whose name is unusually long.</p>
<p >Alternatively, the collecting process may manually define the above Options Template and provide a template callback function (via <a class="el" href="public_8h.html#ae8b88f4af5446d577db88eb037f08701" title="This function sets the callback that allows the application to set its own context variable with a ne...">fbSessionAddNewTemplateCallback()</a>) to collect and add each element to the Information Model using <a class="el" href="public_8h.html#a553e0ba1b1ca946bd3f69a729d2ca1e4" title="Adds an element that we received via an RFC 5610 Options Record to the given info model.">fbInfoElementAddOptRecElement()</a> and <a class="el" href="public_8h.html#ae7754b935026997a60228ca1fce9e19d" title="Checks to see if a template describes a meta-data record according to the bit-field value in tests.">fbTemplateIsMetadata()</a>.</p>
<p >Previous: <a href="lists.html">Lists in IPFIX</a> | Next: <a href="sample_progs.html">Complete Programs</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</body>
</html>
